<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

</head>
<body>
    <h1>Könykiadaás</h1>
    <label for="szerzonev">2.Feladat: Szerző:</label>
    <input type="text" id="szerzonev">
    <input type="button" onclick="feladat2()" value="Keresés" class="btn btn-success">
    <div id="eredmeny2"></div>

    <label>3.Feladat: Legnagyobb példányszám:</label>
    <input type="button" onclick="feladat3()" value="Keresés" class="btn btn-success">
    <div id="eredmeny3"></div>

    <label>4.Feladat: 40.000 feletti külföldi író:</label>
    <input type="button" onclick="feladat4()" value="Keresés" class="btn btn-success">
    <div id="eredmeny4"></div>

    <label>5.Feladat: </label>
    <input type="button" onclick="feladat5()" value="Keresés" class="btn btn-success">
    <div id="eredmeny5"></div>

      <label>6.Feladat: </label>
    <input type="button" onclick="feladat6()" value="Keresés" class="btn btn-success">
    <div id="eredmeny6"></div>

    <script>
        function feladat2()
        {
            let nev=document.querySelector("#szerzonev").value;
            let nevdarab=nev.split(" ");
            let kulfoldiNev=nevdarab.toReversed().join(", ");
            
            let talalat=adatok.filter(e=>e.mu.includes(nev) || e.mu.includes(kulfoldiNev))
            //console.log(talalat)
            let doboz=document.getElementById("eredmeny2")
            if(talalat.length==0)
            {
                doboz.innerHTML="Nincs találat!"
            }
            else
            {
                doboz.innerHTML=talalat.length+" könyvkiadás";
            }

        }
        function feladat3()
        {
            adatok.map(e=>e.peldany).toSorted((a,b)=>b-a);

            console.log(Math.max(...adatok,map(e=>e.peldany)));

            let talalatok=adatok.filter(e=>e.peldany==Math.max(...adatok.map(e=>e.peldany)));

            document.getElementById("eredmeny3").innerHTML="Legnagyobb példányszám: "+talalatok[0].peldany+". előfordult" + talalatok.length;
        }

        function feladat4()
        {
            let talalat=adatok.find(e=>e.nemzetiseg=="kf" && e.peldany >=40000);
            document.getElementById("eredmeny4").innerHTML=`${talalat.ev}/${talalat.negyedev}/${talalat.mu}`;
        }

  function feladat5(){
            let talalatok ={};
            adatok.forEach(e=>{
                //if(talalatok[e.ev]===undefined) talalatok[e.ev]={"ma":[],"kf":[]};
                if(talalatok[e.ev]===undefined) talalatok[e.ev]={"ma":[],"kf":[]};
                talalatok[e.ev][e.nemzetiseg].push(e.peldanyszam);
            });
            
            let tabla = document.createElement("table");
            /*tabla.appendChild(["Év","Magyar kiadás","Magyar példányszám","Külföldi kiadás", "Külföldi példányszám" ]
                .map(e=>document.createElement("th",{innerHTML:e}))
                .reduce((tr,e)=>tr.appendChild(e),document.createElement("tr")));*/

                let elem = ["Év","Magyar kiadás","Magyar példányszám","Külföldi kiadás", "Külföldi példányszám" ]
                .map(e=>{let temp=document.createElement("th");
                temp.innerHTML=e;
                return temp;
          })
          let header=document.createElement("tr");
          elem.forEach(e=>header.appendChild(e));
          tabla.appendChild(header);


            for(let [ev, kiadas] of Object.entries(talalatok)){
                let sor = document.createElement("tr");
                let cellaEv=document.createElement("td");
                cellaEv.innerHTML=ev;
                cellaMagyar = document.createElement("td");
                cellaMagyar.innerHTML=kiadas.ma.length;
                cellaPeldanyMagyar= document.createElement("td");
                cellaPeldanyMagyar.innerHTML=kiadas.ma.reduce((osszeg,e)=>osszeg+e);
                //cellaMagyar.innerHTML

                sor.appendChild(cellaEv);
                sor.appendChild(cellaMagyar);
                sor.appendChild(cellaPeldanyMagyar);
                tabla.appendChild(sor);
            }
            for(let [ev, kiadas] of Object.entries(talalatok)){
                let sor = document.createElement("tr");
                let cellaEv=document.createElement("td");
                cellaEv.innerHTML=ev;
                cellaKulfoldi = document.createElement("td");
                cellaKulfoldi.innerHTML=kiadas.kf.length;
                cellaPeldanyKulfoldi= document.createElement("td");
                cellaPeldanyKulfoldi.innerHTML=kiadas.kf.reduce((osszeg,e)=>osszeg+e);
                //cellaMagyar.innerHTML

                sor.appendChild(cellaEv);
                sor.appendChild(cellaKulfoldi);
                sor.appendChild(cellaPeldanyKulfoldi);
                tabla.appendChild(sor);
            }
            document.getElementById("eredmeny5").appendChild(tabla);
            
            //adatok.map(e=>e.ev)
            //document.getElementById("eredmeny5").innerHTML=talalat;
        }
        function feladat6()
        {
            const talalat={};
            {

            };
            adatok.forEach(e=>{
                if(talalat[e.mu]===undefined) talalat[e.mu]=[];
            
                talalat[e.mu].push(e.peldany);
                //console.log(talalat)
            });

            let talalat2=talalat.filter(e=>e.length>=3).filter(e=>e[0]<e[1] && e[0] < e[0]); 
            console.log(talalat2);
            
        }
        let adatok=[];


        fetch("utolso.json")
        .then(function(valasz){return valasz.json()})
        .then(function(json){adatok=json;});
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
</body>
</html>